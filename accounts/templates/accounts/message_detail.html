{% extends 'base.html' %}
{% load static %}
{% load django_bootstrap5 %}

{% block css %}
<link rel="stylesheet" href="/static/css/articles_detail.css">
<link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"
  integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
<script src="http://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script type="text/javascript" src="stopwatch.js"></script>

{% endblock css %}

{% block content %}
<h1>메시지 디테일</h1>
<a href="" type="button" data-bs-toggle="modal" data-bs-target="#exampleModal3">메시지 신고하기</a>
<h3>{{ message.content }}</h3>
<img src="{{ message.song.song_thumbnail }}" style="height: 300px;" />
<!--음악재생,스톱워치-->
{% if message.song != null %}
    <div id='box' class="box">
        <div id='timerBox' class="timerBox">
        <div id="time" class="time">00:00:00</div>
        </div>
        <div class="btnBox">
        <i id="play-button" class="fa fa-play" aria-hidden="true"></i>
        <i id="pause-button" class="fa fa-pause" aria-hidden="true"></i>
        <i id="stop-button" class="fa fa-stop" aria-hidden="true"></i>
        </div>
    </div>


    <div id="player"></div>
{% endif %}
<!-- 메시지 신고 Modal -->
<div class="modal fade" id="exampleModal3" tabindex="-1" aria-labelledby="exampleModalLabel3" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="exampleModalLabel3">신고하기</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form action="{% url 'accounts:message_declaration' message.pk %}" method="POST">
                {% csrf_token %}
                {% bootstrap_form message_declaration_form %}
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-danger">신고하기</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<!--스톱워치 음악재생 end-->

 <!--음악재생 스크립트!-->

  <!-- 1. The < iframe > (and video player) will replace this < div > tag. -->



  <script>

    // 2. This code loads the IFrame Player API code asynchronously.

    var tag = document.createElement('script');

    tag.src = "https://www.youtube.com/iframe_api";

    var firstScriptTag = document.getElementsByTagName('script')[0];

    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);



    // 3. This function creates an <iframe> (and YouTube player)

    //    after the API code downloads.

    var player;

    function onYouTubeIframeAPIReady() {

      player = new YT.Player('player', {

        height: '0',

        width: '0',

        videoId: '{{ message.song.song_url }}',

        playerVars: { 'controls': 2, 'autohide': 1, 'playlist': '{{ message.song.song_url }}', 'loop': 1, 'start': '0' },

        events: {

          'onReady': onPlayerReady,

          'onStateChange': onPlayerStateChange

        }

      });

    }



    // 4. The API will call this function when the video player is ready.


    function onPlayerReady(event) {
      var playButton = document.getElementById("play-button");
      playButton.addEventListener("click", function () {
        event.target.setVolume(10);
        event.target.getVolume(10);
        player.playVideo(10);
      });
      var pauseButton = document.getElementById("pause-button");
      pauseButton.addEventListener("click", function () {
        event.target.setVolume(10);
        event.target.getVolume(10);
        player.pauseVideo(10);
      });
      var stopButton = document.getElementById("stop-button");
      stopButton.addEventListener("click", function () {
        event.target.setVolume(10);
        event.target.getVolume(10);
        player.stopVideo(10);
      });
    }



    // 5. The API calls this function when the player's state changes.

    //    The function indicates that when playing a video (state=1),

    //    the player should play for six seconds and then stop.

    var done = false;

    function onPlayerStateChange(event) {

      if (event.data == YT.PlayerState.PLAYING && !done) {

        done = true;

      }

    }

    function stopVideo() {
      event.target.setVolume(10);
      event.target.getVolume(10);
      player.stopVideo(10);

    }

  </script>
  <!--음악재생 스크립트 마지막!-->

  <!--스톱워치-->

  <script>
    var time = 0;
    var starFlag = true;
    $(document).ready(function () {
      buttonEvt();
    });

    function init() {
      document.getElementById("time").innerHTML = "00:00:00";
    }

    function buttonEvt() {
      var hour = 0;
      var min = 0;
      var sec = 0;
      var timer;

      // start btn
      $("#play-button").click(function () {

        if (starFlag) {
          $(".fa").css("color", "#FAED7D")
          this.style.color = "#4C4C4C";
          starFlag = false;

          if (time == 0) {
            init();
          }

          timer = setInterval(function () {
            time++;

            min = Math.floor(time / 60);
            hour = Math.floor(min / 60);
            sec = time % 60;
            min = min % 60;

            var th = hour;
            var tm = min;
            var ts = sec;
            if (th < 10) {
              th = "0" + hour;
            }
            if (tm < 10) {
              tm = "0" + min;
            }
            if (ts < 10) {
              ts = "0" + sec;
            }

            document.getElementById("time").innerHTML = th + ":" + tm + ":" + ts;
          }, 1000);
        }
      });

      // pause btn
      $("#pause-button").click(function () {
        if (time != 0) {
          $(".fa").css("color", "#FAED7D")
          this.style.color = "#4C4C4C";
          clearInterval(timer);
          starFlag = true;
        }
      });

      // stop btn
      $("#stop-button").click(function () {
        if (time != 0) {
          $(".fa").css("color", "#FAED7D")
          this.style.color = "#4C4C4C";
          clearInterval(timer);
          starFlag = true;
          time = 0;
          init();
        }
      });
    }

  </script>

  <!--스톱워치 끝-->
{% endblock content %}

